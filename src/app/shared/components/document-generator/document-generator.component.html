<div class="document-generator-container">
  
  <!-- Información de la solicitud -->
  <mat-card class="solicitud-info-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>info</mat-icon>
        Información de la Solicitud
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="solicitud-details">
        <div class="detail-row">
          <span class="label">Estudiante:</span>
          <span class="value">{{ datosSolicitud.nombreEstudiante }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Código:</span>
          <span class="value">{{ datosSolicitud.codigoEstudiante }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Programa:</span>
          <span class="value">{{ datosSolicitud.programa }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Fecha de solicitud:</span>
          <span class="value">{{ datosSolicitud.fechaSolicitud | date:'shortDate' }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Estado:</span>
          <span class="value estado-badge" [ngClass]="'estado-' + datosSolicitud.estado?.toLowerCase()">
            {{ datosSolicitud.estado }}
          </span>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Formulario de generación de documento -->
  <mat-card class="document-form-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>{{ getTemplateIcon() }}</mat-icon>
        {{ template.nombre }}
      </mat-card-title>
      <mat-card-subtitle>{{ template.descripcion }}</mat-card-subtitle>
    </mat-card-header>
    
    <mat-card-content>
      <form [formGroup]="documentForm" (ngSubmit)="onSubmit()" class="document-form">
        
        <!-- Número de documento -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Número de {{ template.nombre }}</mat-label>
          <input matInput 
                 formControlName="numeroDocumento" 
                 placeholder="Ej: 001-2024"
                 [class.error]="hasError('numeroDocumento')">
          <mat-icon matSuffix>description</mat-icon>
          <mat-error *ngIf="hasError('numeroDocumento')">
            {{ getFieldError('numeroDocumento') }}
          </mat-error>
        </mat-form-field>

        <!-- Fecha del documento -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Fecha del documento</mat-label>
          <input matInput 
                 [matDatepicker]="picker" 
                 formControlName="fechaDocumento"
                 [class.error]="hasError('fechaDocumento')">
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          <mat-icon matSuffix>calendar_today</mat-icon>
          <mat-error *ngIf="hasError('fechaDocumento')">
            {{ getFieldError('fechaDocumento') }}
          </mat-error>
        </mat-form-field>

        <!-- Campos opcionales específicos del proceso -->
        <div *ngIf="template.camposOpcionales && template.camposOpcionales.length > 0" class="optional-fields">
          <mat-divider></mat-divider>
          <h4>Información Adicional</h4>
          
          <div *ngFor="let campo of template.camposOpcionales" class="optional-field">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>{{ getFieldLabel(campo) }}</mat-label>
              <input matInput 
                     [formControlName]="campo" 
                     [placeholder]="getFieldPlaceholder(campo)"
                     [class.error]="hasError(campo)">
              <mat-icon matSuffix>{{ getFieldIcon(campo) }}</mat-icon>
              <mat-error *ngIf="hasError(campo)">
                {{ getFieldError(campo) }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- Observaciones -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Observaciones (Opcional)</mat-label>
          <textarea matInput 
                    formControlName="observaciones" 
                    rows="3"
                    placeholder="Observaciones adicionales sobre el documento..."></textarea>
          <mat-icon matSuffix>note</mat-icon>
        </mat-form-field>

      </form>
    </mat-card-content>

    <mat-card-actions class="form-actions">
      <button mat-button 
              type="button" 
              (click)="onCancel()"
              [disabled]="loading">
        <mat-icon>cancel</mat-icon>
        Cancelar
      </button>
      
      <button mat-raised-button 
              color="primary" 
              type="submit"
              (click)="onSubmit()"
              [disabled]="documentForm.invalid || loading">
        <mat-icon *ngIf="!loading">description</mat-icon>
        <mat-icon *ngIf="loading" class="spinning">refresh</mat-icon>
        {{ loading ? 'Generando...' : 'Generar ' + template.nombre }}
      </button>
    </mat-card-actions>
  </mat-card>

</div>

