<div class="secretaria-container">

  <!-- PestaÃ±as para Pendientes y Procesadas -->
  <mat-tab-group>
    
    <!-- PestaÃ±a 1: Pendientes de Procesar -->
    <mat-tab label="Pendientes de Procesar">
      <div class="tab-content">
        <app-card-container
          title="Solicitudes Pendientes de Procesar">
          
          <app-request-status-table
            [solicitudes]="solicitudes"
            [showOficio]="false"
            [showComentarios]="false"
            [showSeleccionar]="true"
            (solicitudSeleccionada)="onSolicitudSeleccionada($event)">
          </app-request-status-table>
          
          <p *ngIf="solicitudes.length === 0" class="no-solicitudes">
            No hay solicitudes pendientes de procesar
          </p>
        </app-card-container>
      </div>
    </mat-tab>

    <!-- PestaÃ±a 2: Historial - Ya Procesadas -->
    <mat-tab label="Historial - Ya Procesadas">
      <div class="tab-content">
        <app-card-container
          title="Solicitudes Procesadas">
          
          <!-- Filtro por perÃ­odo acadÃ©mico -->
          <div class="filtro-periodo">
            <app-periodo-filtro-selector
              label="Filtrar por perÃ­odo acadÃ©mico"
              [mostrarTodos]="true"
              [incluirActual]="true"
              [mostrarInfo]="false"
              (periodoChange)="onPeriodoChange($event)">
            </app-periodo-filtro-selector>
          </div>
          
          <app-request-status-table
            [solicitudes]="solicitudesProcesadas"
            [showOficio]="false"
            [showComentarios]="false"
            [showSeleccionar]="false">
          </app-request-status-table>
          
          <p *ngIf="solicitudesProcesadas.length === 0" class="no-solicitudes">
            No hay solicitudes procesadas todavÃ­a
          </p>
        </app-card-container>
      </div>
    </mat-tab>

  </mat-tab-group>

      

      <!-- Contenedor para generar documento usando componente genÃ©rico -->
      <app-card-container
        *ngIf="selectedSolicitud"
        title="Generar Documento Oficio/ResoluciÃ³n">

        <app-document-generator
          [solicitud]="selectedSolicitud"
          [template]="template"
          [proceso]="'paz-salvo'"
          [loading]="loading"
          (generarDocumento)="onGenerarDocumento($event)"
          (cancelar)="onCancelarGeneracion()"
          (tengoDocumento)="onTengoDocumento()">
        </app-document-generator>

      </app-card-container>

      <!-- Contenedor para subir PDF y enviar al estudiante -->
      <app-card-container
        *ngIf="selectedSolicitud && (documentoGenerado || documentoHabilitado)"
        title="Subir PDF y Enviar al Estudiante">

        <div class="pdf-upload-section">
          <p class="instruction" *ngIf="documentoGenerado">
            ðŸ“„ <strong>Paso 1:</strong> El documento Word ha sido generado y descargado.<br>
            <strong>Paso 2:</strong> Selecciona el archivo PDF y envÃ­alo al estudiante.
          </p>
          <p class="instruction" *ngIf="!documentoGenerado && documentoHabilitado">
            <strong>Sube tu documento PDF:</strong> Selecciona el archivo PDF que ya tienes listo y envÃ­alo al estudiante.
          </p>

          <!-- SelecciÃ³n de archivo PDF -->
          <div class="file-selection">
            <input
              type="file"
              accept=".pdf"
              (change)="onArchivoSeleccionado($event)"
              #fileInput
              class="file-input">

            <button
              mat-raised-button
              color="primary"
              (click)="fileInput.click()"
              class="select-file-btn">
              <mat-icon>attach_file</mat-icon>
              Seleccionar PDF
            </button>

            <span *ngIf="archivoPDF" class="selected-file">
              {{ archivoPDF.name }}
            </span>
          </div>

          <!-- BotÃ³n Ãºnico: Subir y Enviar al Estudiante -->
          <div class="action-buttons">
            <button
              mat-raised-button
              color="primary"
              [disabled]="!archivoPDF || subiendoPDF || enviandoPDF"
              (click)="enviarDocumento()"
              class="upload-send-btn">
              <mat-icon>publish</mat-icon>
              <span *ngIf="subiendoPDF || enviandoPDF">Procesando...</span>
              <span *ngIf="!subiendoPDF && !enviandoPDF">Subir y Enviar</span>
            </button>
          </div>

          <!-- Barra de progreso -->
          <mat-progress-bar
            *ngIf="subiendoPDF || enviandoPDF"
            mode="indeterminate"
            class="progress-bar">
          </mat-progress-bar>
        </div>

      </app-card-container>

</div>
