<div class="secretaria-container">

  <!-- Tabla de solicitudes pendientes usando componente genÃ©rico -->
  <app-card-container
    title="Solicitudes de HomologaciÃ³n - SecretarÃ­a"
    icon="assignment">

    <app-request-status-table
      [solicitudes]="solicitudes"
      [showOficio]="false"
      [showComentarios]="false"
      [showSeleccionar]="true"
      (solicitudSeleccionada)="onSolicitudSeleccionada($event)">
    </app-request-status-table>

  </app-card-container>

      <!-- DocumentaciÃ³n adjunta de la solicitud seleccionada -->
      <app-card-container
        *ngIf="selectedSolicitud"
        title="DocumentaciÃ³n Adjunta"
        icon="folder_open">

        <app-documentation-viewer
          [documentos]="selectedSolicitud.documentos || []"
          [solicitudId]="selectedSolicitud.id_solicitud"
          [proceso]="'homologacion'"
          [servicio]="homologacionService">
        </app-documentation-viewer>

      </app-card-container>

      <!-- Contenedor para generar documento usando componente genÃ©rico -->
      <app-card-container
        *ngIf="selectedSolicitud"
        title="Generar Documento Oficio/ResoluciÃ³n"
        icon="description">

        <app-document-generator
          [solicitud]="selectedSolicitud"
          [template]="template"
          [proceso]="'homologacion'"
          [loading]="loading"
          [mostrarObservaciones]="false"
          (generarDocumento)="onGenerarDocumento($event)"
          (cancelar)="onCancelarGeneracion()"
          (tengoDocumento)="onTengoDocumento()">
        </app-document-generator>

      </app-card-container>

      <!-- Contenedor para subir PDF y enviar al estudiante -->
      <app-card-container
        *ngIf="selectedSolicitud && (documentoGenerado || documentoHabilitado)"
        title="Subir PDF y Enviar al Estudiante"
        icon="upload">

        <div class="pdf-upload-section">
          <p class="instruction" *ngIf="documentoGenerado">
            ðŸ“„ <strong>Paso 1:</strong> El documento Word ha sido generado y descargado.<br>
            ðŸ“¤ <strong>Paso 2:</strong> Selecciona el archivo PDF y envÃ­alo al estudiante.
          </p>
          <p class="instruction" *ngIf="!documentoGenerado && documentoHabilitado">
            ðŸ“¤ <strong>Sube tu documento PDF:</strong> Selecciona el archivo PDF que ya tienes listo y envÃ­alo al estudiante.
          </p>

          <!-- SelecciÃ³n de archivo PDF -->
          <div class="file-selection">
            <input
              type="file"
              accept=".pdf"
              (change)="onArchivoSeleccionado($event)"
              #fileInput
              class="file-input">

            <button
              mat-raised-button
              color="primary"
              (click)="fileInput.click()"
              class="select-file-btn">
              <mat-icon>attach_file</mat-icon>
              Seleccionar PDF
            </button>

            <span *ngIf="archivoPDF" class="selected-file">
              âœ… {{ archivoPDF.name }}
            </span>
          </div>

          <!-- BotÃ³n unificado: Subir PDF y Enviar al Estudiante -->
          <div class="action-buttons">
            <button
              mat-raised-button
              color="primary"
              [disabled]="!archivoPDF || subiendoPDF || enviandoPDF"
              (click)="enviarDocumento()"
              class="send-btn">
              <mat-icon>send</mat-icon>
              <span *ngIf="subiendoPDF">Subiendo PDF...</span>
              <span *ngIf="!subiendoPDF && enviandoPDF">Enviando...</span>
              <span *ngIf="!subiendoPDF && !enviandoPDF">Enviar al Estudiante</span>
            </button>
          </div>

          <!-- Barra de progreso -->
          <mat-progress-bar
            *ngIf="subiendoPDF || enviandoPDF"
            mode="indeterminate"
            class="progress-bar">
          </mat-progress-bar>
        </div>

      </app-card-container>

      <app-approved-requests-section
        title="Solicitudes aprobadas"
        icon="task_alt"
        [solicitudes]="solicitudesAprobadas"
        [loading]="cargandoSolicitudesAprobadas">
      </app-approved-requests-section>
 
</div>
