<app-card-container title="Mis Inscripciones y Preinscripciones">
  <div *ngIf="cargando" class="cargando">Cargando datos...</div>

  <!-- Sección de Preinscripciones -->
  <div *ngIf="!cargando && solicitudes.length > 0" class="section">
    <h3>Mis Preinscripciones</h3>
    <table mat-table [dataSource]="solicitudes" class="mat-elevation-z8">
      
      <!-- Curso -->
      <ng-container matColumnDef="curso">
        <th mat-header-cell *matHeaderCellDef>Curso</th>
        <td mat-cell *matCellDef="let solicitud">{{ solicitud.curso || 'N/A' }}</td>
      </ng-container>

      <!-- Fecha -->
      <ng-container matColumnDef="fecha">
        <th mat-header-cell *matHeaderCellDef>Fecha</th>
        <td mat-cell *matCellDef="let solicitud">{{ solicitud.fecha | date:'short' }}</td>
      </ng-container>

      <!-- Estado -->
      <ng-container matColumnDef="estado">
        <th mat-header-cell *matHeaderCellDef>Estado</th>
        <td mat-cell *matCellDef="let solicitud">
          <span [ngClass]="'estado-' + solicitud.estado.toLowerCase()">{{ solicitud.estado }}</span>
        </td>
      </ng-container>

      <!-- Tipo -->
      <ng-container matColumnDef="tipo">
        <th mat-header-cell *matHeaderCellDef>Tipo</th>
        <td mat-cell *matCellDef="let solicitud">Preinscripción</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['curso','fecha','estado','tipo']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['curso','fecha','estado','tipo'];"></tr>
    </table>
  </div>

  <!-- Sección de Inscripciones -->
  <div *ngIf="!cargando && inscripciones.length > 0" class="section">
    <h3>Mis Inscripciones</h3>
    <table mat-table [dataSource]="inscripciones" class="mat-elevation-z8">

      <!-- ID del curso -->
      <ng-container matColumnDef="cursoId">
        <th mat-header-cell *matHeaderCellDef>ID Curso</th>
        <td mat-cell *matCellDef="let inscripcion">{{ inscripcion.objCurso?.id_curso || 'N/A' }}</td>
      </ng-container>

      <!-- Fecha -->
      <ng-container matColumnDef="fecha">
        <th mat-header-cell *matHeaderCellDef>Fecha</th>
        <td mat-cell *matCellDef="let inscripcion">{{ inscripcion.fecha_inscripcion | date:'short' }}</td>
      </ng-container>

      <!-- Estado -->
      <ng-container matColumnDef="estado">
        <th mat-header-cell *matHeaderCellDef>Estado</th>
        <td mat-cell *matCellDef="let inscripcion">
          <span [ngClass]="'estado-' + inscripcion.estado.toLowerCase()">{{ inscripcion.estado }}</span>
        </td>
      </ng-container>

      <!-- Archivo de Pago -->
      <ng-container matColumnDef="archivoPago">
        <th mat-header-cell *matHeaderCellDef>Archivo de Pago</th>
        <td mat-cell *matCellDef="let inscripcion">
          <div class="archivo-pago-container">
            <span *ngIf="!inscripcion.archivoPago" class="sin-archivo">
              Sin archivo
            </span>
            <div *ngIf="inscripcion.archivoPago" class="archivo-subido">
              <mat-icon class="archivo-icon">attach_file</mat-icon>
              <span class="archivo-nombre">{{ inscripcion.archivoPago.nombre }}</span>
              <span class="archivo-estado">Subido</span>
            </div>
          </div>
        </td>
      </ng-container>

      <!-- Acciones -->
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef>Acciones</th>
        <td mat-cell *matCellDef="let inscripcion">
          <div class="acciones-container">
            <button *ngIf="!inscripcion.archivoPago && inscripcion.estado !== 'cancelada'" 
                    mat-raised-button 
                    color="primary" 
                    (click)="onSubirArchivoPago(inscripcion)"
                    class="btn-subir">
              <mat-icon>upload</mat-icon>
              Subir Pago
            </button>
            
            <button *ngIf="inscripcion.estado !== 'cancelada'" 
                    mat-raised-button 
                    color="warn" 
                    (click)="onCancelarInscripcion(inscripcion)"
                    class="btn-cancelar">
              <mat-icon>cancel</mat-icon>
              Cancelar
            </button>
            
            <span *ngIf="inscripcion.estado === 'cancelada'" class="estado-cancelada">
              Ya cancelada
            </span>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['cursoId','fecha','estado','archivoPago','acciones']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['cursoId','fecha','estado','archivoPago','acciones'];"></tr>
    </table>
  </div>

  <!-- Mensaje cuando no hay preinscripciones -->
  <div *ngIf="!cargando && solicitudes.length === 0 && inscripciones.length > 0" class="sin-datos">
    <mat-icon>info</mat-icon>
    <p>No tienes preinscripciones registradas.</p>
    <p>Puedes preinscribirte en cursos desde la sección "Ver Lista de Cursos para Preinscripción".</p>
  </div>

  <!-- Mensaje cuando no hay inscripciones -->
  <div *ngIf="!cargando && solicitudes.length > 0 && inscripciones.length === 0" class="sin-datos">
    <mat-icon>info</mat-icon>
    <p>No tienes inscripciones registradas.</p>
    <p>Una vez que tus preinscripciones sean aprobadas, podrás inscribirte en los cursos.</p>
  </div>

  <!-- Mensaje cuando no hay nada -->
  <div *ngIf="!cargando && solicitudes.length === 0 && inscripciones.length === 0" class="sin-datos">
    <mat-icon>info</mat-icon>
    <p>No tienes inscripciones ni preinscripciones activas.</p>
    <p>Puedes preinscribirte en cursos desde la sección "Ver Lista de Cursos para Preinscripción".</p>
  </div>
</app-card-container>
