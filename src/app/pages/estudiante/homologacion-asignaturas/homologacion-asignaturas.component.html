<div class="homologacion-container">

  <!-- Documentaci칩n requerida -->
  <mat-card class="card-section">
    <mat-card-title class="card-title">Adjuntar Documentaci칩n Requerida</mat-card-title>
    <mat-card-content>
      <ul class="required-list">
        <li *ngFor="let doc of documentosRequeridos">
          {{ doc.label }} <span *ngIf="doc.obligatorio" class="obligatorio">*</span>
        </li>
        <li *ngIf="archivosExclusivos.length">
          {{ archivosExclusivos.join(' o ') }} <span class="nota">(solo uno)</span>
        </li>
      </ul>
    </mat-card-content>
  </mat-card>

  <!-- Subir Archivos -->
  <mat-card class="card-section">
    <mat-card-title class="card-title">Subir Archivos</mat-card-title>
    <mat-card-content>
      <app-file-upload
        [archivos]="archivosActuales"
        (archivosChange)="onArchivosChange($event)"
        [reset]="resetFileUpload">
      </app-file-upload>

      <div class="enviar-solicitud mt-4">
        <button mat-raised-button color="primary"
                [disabled]="!puedeEnviar()"
                (click)="onSolicitudEnviada()">
          Enviar Solicitud
        </button>
      </div>

      <div *ngIf="solicitudes.at(-1)?.estado === 'Rechazada'" class="rechazo-box">
        <mat-icon color="warn">error</mat-icon>
        <span>
          <strong>Solicitud rechazada:</strong>
          {{ solicitudes.at(-1)?.comentarios || 'Debes revisar los documentos y volver a enviarlos.' }}
        </span>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Seguimiento de solicitud -->
  <mat-card class="card-section">
    <mat-card-title class="card-title">Seguimiento de solicitud</mat-card-title>
    <mat-card-content>
      <p *ngIf="solicitudes.length === 0" class="sin-solicitudes">
        No se ha enviado ninguna solicitud a칰n.
      </p>

      <app-request-status-table
        *ngIf="solicitudes.length > 0"
        [solicitudes]="solicitudes"
        [showOficio]="true"
        [showComentarios]="true"
        (verComentarios)="verComentarios($event)"
        (descargarOficio)="descargarOficio($event.id, $event.nombreArchivo)">
      </app-request-status-table>

      <!-- Bot칩n adicional para ver oficios disponibles -->
      <div *ngIf="solicitudes.length > 0" class="oficios-section mt-3">
        <h4>游늯 Documentos Oficiales</h4>
        <div *ngFor="let solicitud of solicitudes" class="solicitud-oficios">
          <div class="solicitud-info">
            <span class="solicitud-nombre">{{ solicitud.nombre }}</span>
            <span class="solicitud-estado" [ngClass]="'estado-' + solicitud.estado.toLowerCase()">
              {{ solicitud.estado }}
            </span>
          </div>
          
          <button *ngIf="tieneOficios(solicitud.id)" 
                  mat-raised-button 
                  color="primary" 
                  (click)="obtenerOficios(solicitud.id)"
                  class="btn-oficios">
            <mat-icon>description</mat-icon>
            Ver Documentos Oficiales
          </button>
          
          <p *ngIf="!tieneOficios(solicitud.id)" class="sin-oficios">
            Los documentos oficiales estar치n disponibles una vez que la solicitud sea aprobada.
          </p>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

</div>
