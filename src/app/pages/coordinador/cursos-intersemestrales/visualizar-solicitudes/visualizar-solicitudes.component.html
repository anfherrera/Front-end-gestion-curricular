<app-card-container title="Solicitudes de Cursos Intersemestrales de Verano">
  
  <!-- Filtros -->
  <div class="filtros-container" [formGroup]="filtroForm">
    <mat-form-field appearance="outline" class="filtro-field">
      <mat-label>Filtrar por materia</mat-label>
      <mat-select formControlName="materia">
        <mat-option *ngFor="let materia of materias" [value]="materia.id_materia">
          {{ materia.nombre | utfFix }}
        </mat-option>
      </mat-select>
    </mat-form-field>
    
    <app-periodo-filtro-selector
      [mostrarTodos]="true"
      [incluirActual]="false"
      [mostrarInfo]="true"
      [periodoInicial]="periodoFiltro"
      label="Filtrar por período académico"
      (periodoChange)="onPeriodoChange($event)"
      class="filtro-field">
    </app-periodo-filtro-selector>
    
    <button mat-raised-button 
            color="primary" 
            (click)="cargarSolicitudes()"
            [disabled]="cargando">
      <mat-icon>refresh</mat-icon>
      Actualizar
    </button>
    
    <button mat-raised-button 
            color="accent"
            (click)="exportarSolicitudesExcel()"
            [disabled]="cargando || exportando"
            style="background-color: #28a745; color: white; margin-left: 8px;">
      <mat-icon>{{ exportando ? 'hourglass_empty' : 'download' }}</mat-icon>
      {{ exportando ? 'Exportando...' : 'Exportar a Excel' }}
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="cargando" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Cargando solicitudes...</p>
  </div>

  <!-- Lista de solicitudes -->
  <div *ngIf="!cargando" class="solicitudes-section">
    <h3>Todas las Solicitudes</h3>
    
    <div *ngIf="solicitudesFiltradas.length === 0" class="no-data">
      <mat-icon>info</mat-icon>
      <p>No hay solicitudes para mostrar</p>
      <p><small>Intenta cambiar el filtro de materia</small></p>
    </div>

    <div *ngIf="solicitudesFiltradas.length > 0" class="table-container">
      <table mat-table [dataSource]="solicitudesFiltradas" class="solicitudes-table">
      
      <!-- Nombre Completo -->
      <ng-container matColumnDef="nombre">
        <th mat-header-cell *matHeaderCellDef>Nombre Completo</th>
        <td mat-cell *matCellDef="let solicitud">
          <div class="estudiante-info">
            <strong>{{ solicitud.nombreCompleto | utfFix }}</strong>
          </div>
        </td>
      </ng-container>

      <!-- Código -->
      <ng-container matColumnDef="codigo">
        <th mat-header-cell *matHeaderCellDef>Código</th>
        <td mat-cell *matCellDef="let solicitud">
          <span class="codigo-text">{{ solicitud.codigo }}</span>
        </td>
      </ng-container>

      <!-- Curso -->
      <ng-container matColumnDef="curso">
        <th mat-header-cell *matHeaderCellDef>Curso</th>
        <td mat-cell *matCellDef="let solicitud">
          <div class="curso-info">
            <strong>{{ solicitud.curso | utfFix }}</strong>
          </div>
        </td>
      </ng-container>

        <!-- Condición -->
        <ng-container matColumnDef="condicion">
          <th mat-header-cell *matHeaderCellDef>Condición</th>
          <td mat-cell *matCellDef="let solicitud">
            <span class="condicion-badge" [ngClass]="getCondicionClass(solicitud.condicion)" style="border: none !important; border-width: 0 !important; border-style: none !important; border-color: transparent !important; outline: none !important; box-shadow: none !important; font-weight: 400 !important;">{{ getCondicionTexto(solicitud.condicion) }}</span>
          </td>
        </ng-container>

        <!-- Motivo de la Solicitud -->
        <ng-container matColumnDef="motivo">
          <th mat-header-cell *matHeaderCellDef>Motivo de la Solicitud</th>
          <td mat-cell *matCellDef="let solicitud">
            <span class="motivo-text">{{ solicitud.motivoSolicitud | utfFix }}</span>
          </td>
        </ng-container>

        <!-- Estado -->
        <ng-container matColumnDef="estado">
          <th mat-header-cell *matHeaderCellDef>Estado</th>
          <td mat-cell *matCellDef="let solicitud">
            <span class="estado-badge" [ngClass]="getEstadoClass(solicitud.estado)" style="border: none !important; border-width: 0 !important; border-style: none !important; border-color: transparent !important; outline: none !important; box-shadow: none !important; font-weight: 400 !important;">
              {{ getEstadoTexto(solicitud.estado) }}
            </span>
          </td>
        </ng-container>

      <!-- Fecha -->
      <ng-container matColumnDef="fecha">
        <th mat-header-cell *matHeaderCellDef>Fecha</th>
        <td mat-cell *matCellDef="let solicitud">
          {{ solicitud.fecha | date:'short' }}
        </td>
      </ng-container>

    <tr mat-header-row *matHeaderRowDef="['nombre','codigo','curso','condicion','motivo','estado','fecha']"></tr>
    <tr mat-row *matRowDef="let row; columns: ['nombre','codigo','curso','condicion','motivo','estado','fecha'];"></tr>
      </table>
    </div>
  </div>

</app-card-container>
