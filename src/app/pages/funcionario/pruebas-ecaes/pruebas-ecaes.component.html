<div class="pruebas-ecaes-funcionario-container">

  <!--  Primera Secci贸n: Publicar Fechas -->
  <app-card-container title="Publicar fechas" icon="event">

    <form [formGroup]="fechasForm" class="fechas-form">

      <!-- Per铆odo Acad茅mico centrado en la parte superior -->
      <div class="periodo-academico-section">
        <mat-form-field appearance="outline" class="periodo-field">
          <mat-label>Per铆odo Acad茅mico</mat-label>
          <mat-select formControlName="periodoAcademico" placeholder="Seleccione un per铆odo">
            <mat-option *ngFor="let periodo of periodosAcademicos" [value]="periodo">
              {{ periodo }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="esCampoInvalido('periodoAcademico')">
            {{ obtenerMensajeError('periodoAcademico') }}
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Grid de fechas 3x2 -->
      <div class="fechas-grid-container">

        <!-- Inscripci贸n de estudiantes por parte de la Facultad -->
        <div class="fecha-item">
          <label class="fecha-label">Inscripci贸n de estudiantes por parte de la Facultad</label>
          <mat-form-field appearance="outline" class="fecha-field">
            <input matInput [matDatepicker]="inscripcionPicker" formControlName="inscripcion_est_by_facultad">
            <mat-datepicker-toggle matSuffix [for]="inscripcionPicker"></mat-datepicker-toggle>
            <mat-datepicker #inscripcionPicker></mat-datepicker>
            <mat-error *ngIf="esCampoInvalido('inscripcion_est_by_facultad')">
              {{ obtenerMensajeError('inscripcion_est_by_facultad') }}
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Registro y recaudo ordinario -->
        <div class="fecha-item">
          <label class="fecha-label">Registro y recaudo ordinario</label>
          <mat-form-field appearance="outline" class="fecha-field">
            <input matInput [matDatepicker]="recaudoOrdinarioPicker" formControlName="registro_recaudo_ordinario">
            <mat-datepicker-toggle matSuffix [for]="recaudoOrdinarioPicker"></mat-datepicker-toggle>
            <mat-datepicker #recaudoOrdinarioPicker></mat-datepicker>
            <mat-error *ngIf="esCampoInvalido('registro_recaudo_ordinario')">
              {{ obtenerMensajeError('registro_recaudo_ordinario') }}
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Registro y recaudo extraordinario -->
        <div class="fecha-item">
          <label class="fecha-label">Registro y recaudo extraordinario</label>
          <mat-form-field appearance="outline" class="fecha-field">
            <input matInput [matDatepicker]="recaudoExtraordinarioPicker" formControlName="registro_recaudo_extraordinario">
            <mat-datepicker-toggle matSuffix [for]="recaudoExtraordinarioPicker"></mat-datepicker-toggle>
            <mat-datepicker #recaudoExtraordinarioPicker></mat-datepicker>
            <mat-error *ngIf="esCampoInvalido('registro_recaudo_extraordinario')">
              {{ obtenerMensajeError('registro_recaudo_extraordinario') }}
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Citaci贸n -->
        <div class="fecha-item">
          <label class="fecha-label">Citaci贸n</label>
          <mat-form-field appearance="outline" class="fecha-field">
            <input matInput [matDatepicker]="citacionPicker" formControlName="citacion">
            <mat-datepicker-toggle matSuffix [for]="citacionPicker"></mat-datepicker-toggle>
            <mat-datepicker #citacionPicker></mat-datepicker>
            <mat-error *ngIf="esCampoInvalido('citacion')">
              {{ obtenerMensajeError('citacion') }}
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Aplicaci贸n -->
        <div class="fecha-item">
          <label class="fecha-label">Aplicaci贸n</label>
          <mat-form-field appearance="outline" class="fecha-field">
            <input matInput [matDatepicker]="aplicacionPicker" formControlName="aplicacion">
            <mat-datepicker-toggle matSuffix [for]="aplicacionPicker"></mat-datepicker-toggle>
            <mat-datepicker #aplicacionPicker></mat-datepicker>
            <mat-error *ngIf="esCampoInvalido('aplicacion')">
              {{ obtenerMensajeError('aplicacion') }}
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Resultados individuales -->
        <div class="fecha-item">
          <label class="fecha-label">Resultados individuales</label>
          <mat-form-field appearance="outline" class="fecha-field">
            <input matInput [matDatepicker]="resultadosPicker" formControlName="resultados_individuales">
            <mat-datepicker-toggle matSuffix [for]="resultadosPicker"></mat-datepicker-toggle>
            <mat-datepicker #resultadosPicker></mat-datepicker>
            <mat-error *ngIf="esCampoInvalido('resultados_individuales')">
              {{ obtenerMensajeError('resultados_individuales') }}
            </mat-error>
          </mat-form-field>
        </div>

      </div>

      <!-- Bot贸n de publicaci贸n -->
      <div class="boton-publicacion">
        <button
          mat-raised-button
          color="primary"
          (click)="publicarFechas()"
          [disabled]="publicandoFechas || fechasForm.invalid"
          class="btn-publicar">
          <mat-icon *ngIf="!publicandoFechas">publish</mat-icon>
          <mat-icon *ngIf="publicandoFechas" class="spinning">refresh</mat-icon>
          {{ publicandoFechas ? 'Publicando...' : 'Publicar' }}
        </button>
      </div>

    </form>

  </app-card-container>

  <!--  Segunda Secci贸n: Solicitudes Pre-Registro Pendientes -->
  <app-card-container title="Pre-Registros Pendientes" icon="pending_actions">

    <!-- Mensaje cuando no hay solicitudes -->
    <div class="sin-solicitudes" *ngIf="solicitudesPendientes.length === 0">
      <mat-icon>info</mat-icon>
      <p>No hay solicitudes pre-registro pendientes.</p>
    </div>

    <!-- Tabla de solicitudes pendientes -->
    <app-request-status-table
      *ngIf="solicitudesPendientes.length > 0"
      [solicitudes]="solicitudesPendientes"
      [showOficio]="false"
      [showComentarios]="true"
      [showSeleccionar]="true"
      (verComentarios)="verComentarios($event)"
      (solicitudSeleccionada)="onSolicitudSeleccionada($event)">
    </app-request-status-table>

  </app-card-container>

  <!--  Tercera Secci贸n: Documentaci贸n Adjunta -->
  <app-card-container
    *ngIf="selectedSolicitud"
    title="Documentaci贸n Adjunta"
    icon="description">

    <app-documentation-viewer
      [documentos]="selectedSolicitud.documentos || []"
      [solicitudId]="selectedSolicitud.id_solicitud"
      [proceso]="'ecaes'"
      [servicio]="pruebasEcaesService"
      [puedeAgregarComentarios]="true"
      (comentarioAgregado)="onComentarioAgregado($event)">
    </app-documentation-viewer>

  </app-card-container>

  <!-- Mensaje cuando no hay solicitud seleccionada -->
  <app-card-container
    *ngIf="!selectedSolicitud && solicitudesPendientes.length > 0"
    title="Documentaci贸n Adjunta"
    icon="description">

    <div class="sin-solicitudes">
      <mat-icon>info</mat-icon>
      <p>Seleccione una solicitud para ver su documentaci贸n adjunta.</p>
    </div>

  </app-card-container>

  <!--  Botones de acci贸n para la solicitud -->
  <div class="botones-acciones" *ngIf="selectedSolicitud">
    <button mat-raised-button color="primary" (click)="aprobarSolicitudSeleccionada()">
      Marcar como Pre-registrada
    </button>
    <button mat-raised-button color="warn" (click)="rechazarSolicitudSeleccionada()">
      Rechazar Solicitud
    </button>
  </div>

</div>
