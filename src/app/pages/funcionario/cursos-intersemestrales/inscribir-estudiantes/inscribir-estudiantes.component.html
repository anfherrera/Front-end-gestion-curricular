<app-card-container title="Inscribir Estudiantes">
  
  <!-- Filtro por curso -->
  <div class="filtro-section">
    <h3> Seleccionar Curso</h3>
    <form [formGroup]="filtroForm">
      <mat-form-field appearance="outline" class="curso-selector">
        <mat-label>Selecciona un curso</mat-label>
        <mat-select formControlName="curso" placeholder="Elige un curso para ver las inscripciones">
          <mat-option *ngFor="let curso of cursos" [value]="curso.id_curso">
            {{ curso.nombre_curso }} ({{ curso.codigo_curso }}) - {{ curso.objDocente.nombre }} {{ curso.objDocente.apellido }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </form>
  </div>

  <!-- Panel de Estad铆sticas -->
  <div *ngIf="estadisticas && cursoSeleccionado" class="estadisticas-panel">
    <h3> Estad铆sticas del Curso</h3>
    <div class="stats-grid">
      <div class="stat-item total">
        <span class="stat-number">{{ estadisticas.total_inscripciones || 0 }}</span>
        <span class="stat-label">Total Inscripciones</span>
      </div>
      <div class="stat-item pending">
        <span class="stat-number">{{ estadisticas.pendientes_revision || 0 }}</span>
        <span class="stat-label">Pendientes</span>
      </div>
      <div class="stat-item accepted">
        <span class="stat-number">{{ estadisticas.aceptadas || 0 }}</span>
        <span class="stat-label">Aceptadas</span>
      </div>
      <div class="stat-item rejected">
        <span class="stat-number">{{ estadisticas.rechazadas || 0 }}</span>
        <span class="stat-label">Rechazadas</span>
      </div>
    </div>
  </div>

  <!-- Loading spinner -->
  <div *ngIf="cargando" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Cargando datos...</p>
  </div>

  <!-- Lista de estudiantes elegibles -->
  <div *ngIf="cursoSeleccionado && !cargando" class="inscripciones-section">
    <h3> Estudiantes Elegibles para Inscripci贸n en {{ cursoSeleccionado.nombre_curso }}</h3>
    
    <div *ngIf="estudiantesFiltrados.length === 0" class="no-data">
      <mat-icon>info</mat-icon>
      <p>No hay estudiantes elegibles para inscripci贸n en este curso.</p>
      <p><small>Los estudiantes deben haber completado el proceso de preinscripci贸n aprobada y tener su pago validado.</small></p>
    </div>

    <div *ngIf="estudiantesFiltrados.length > 0" class="table-container">
      <table mat-table [dataSource]="estudiantesFiltrados" class="inscripciones-table">
        
        <!-- Columna Estudiante -->
        <ng-container matColumnDef="estudiante">
          <th mat-header-cell *matHeaderCellDef>Estudiante</th>
          <td mat-cell *matCellDef="let estudiante">
            <div class="estudiante-info">
              <strong>{{ estudiante.nombre_completo }}</strong>
              <small>{{ estudiante.codigo }}</small>
              <small>Tipo: {{ estudiante.tipo_solicitud }}</small>
            </div>
          </td>
        </ng-container>

        <!-- Columna Fecha -->
        <ng-container matColumnDef="fecha_inscripcion">
          <th mat-header-cell *matHeaderCellDef>Informaci贸n</th>
          <td mat-cell *matCellDef="let estudiante">
            <div class="info-estudiante">
              <small>Condici贸n: {{ estudiante.condicion_solicitud }}</small>
              <small>Formal: {{ estudiante.tiene_inscripcion_formal ? 'S铆' : 'No' }}</small>
            </div>
          </td>
        </ng-container>

        <!-- Columna Estado -->
        <ng-container matColumnDef="estado_inscripcion">
          <th mat-header-cell *matHeaderCellDef>Estado</th>
          <td mat-cell *matCellDef="let estudiante">
            <span [ngClass]="{
              'estado-aprobada': estudiante.estado_inscripcion === 'APROBADA',
              'estado-enviada': estudiante.estado_inscripcion === 'Enviada',
              'estado-pago-validado': estudiante.estado_inscripcion === 'Pago_Validado',
              'estado-pago-rechazado': estudiante.estado_inscripcion === 'Pago_Rechazado',
              'estado-default': !estudiante.estado_inscripcion
            }" class="estado-badge">
              {{ estudiante.estado_inscripcion || estudiante.tipo_solicitud }}
            </span>
          </td>
        </ng-container>

        <!-- Columna Comprobante de Pago -->
        <ng-container matColumnDef="comprobante_pago">
          <th mat-header-cell *matHeaderCellDef>Estado del Proceso</th>
          <td mat-cell *matCellDef="let estudiante">
            <div class="comprobante-cell">
              <span *ngIf="estudiante.estado_inscripcion === 'Pago_Rechazado'" class="estado-rechazado">
                <mat-icon style="color: #f44336 !important;">cancel</mat-icon>
                <span>Inscripci贸n rechazada</span>
              </span>
              <span *ngIf="estudiante.estado_inscripcion === 'Pago_Validado'" class="estado-validado">
                <mat-icon style="color: #4CAF50 !important;">check_circle</mat-icon>
                <span>Pago validado</span>
              </span>
              <span *ngIf="estudiante.estado_inscripcion === 'APROBADA'" class="estado-aprobada">
                <mat-icon style="color: #4CAF50 !important;">check_circle</mat-icon>
                <span>Inscripci贸n aprobada</span>
              </span>
              <span *ngIf="estudiante.estado_inscripcion === 'Enviada'" class="estado-enviada">
                <mat-icon style="color: #ff9800 !important;">schedule</mat-icon>
                <span>Pendiente de revisi贸n</span>
              </span>
              <span *ngIf="!estudiante.estado_inscripcion" class="estado-default">
                <mat-icon style="color: #4CAF50 !important;">check_circle</mat-icon>
                <span>Listo para inscripci贸n</span>
              </span>
            </div>
          </td>
        </ng-container>

        <!-- Columna Acciones -->
        <ng-container matColumnDef="acciones">
          <th mat-header-cell *matHeaderCellDef>Acciones</th>
          <td mat-cell *matCellDef="let estudiante">
            <div class="acciones-container">
              <button mat-icon-button 
                      (click)="verDetalles(estudiante)"
                      matTooltip="Ver detalles de inscripci贸n y comprobante"
                      style="color: #00138C !important;">
                <mat-icon style="color: #00138C !important;">visibility</mat-icon>
              </button>
              
              <button mat-icon-button 
                      *ngIf="estudiante.tiene_inscripcion_formal"
                      (click)="confirmarInscripcion(estudiante)"
                      matTooltip="Confirmar inscripci贸n oficial - El estudiante complet贸 todos los requisitos y pago validado"
                      style="color: #4CAF50 !important;">
                <mat-icon style="color: #4CAF50 !important;">check_circle</mat-icon>
              </button>
              
              <button mat-icon-button 
                      *ngIf="estudiante.tiene_inscripcion_formal"
                      (click)="rechazarInscripcion(estudiante)"
                      matTooltip="Rechazar inscripci贸n"
                      style="color: #f44336 !important;">
                <mat-icon style="color: #f44336 !important;">cancel</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </div>
  </div>

  <!-- Informaci贸n del curso seleccionado -->
  <div *ngIf="cursoSeleccionado && !cargando" class="curso-info">
    <h4> Informaci贸n del Curso</h4>
    <div class="info-grid">
      <div class="info-item">
        <strong>Docente:</strong> {{ cursoSeleccionado.objDocente.nombre }} {{ cursoSeleccionado.objDocente.apellido }}
      </div>
      <div class="info-item">
        <strong>Cupo Estimado:</strong> {{ cursoSeleccionado.cupo_estimado }} estudiantes
      </div>
      <div class="info-item">
        <strong>Espacio:</strong> {{ cursoSeleccionado.espacio_asignado }}
      </div>
      <div class="info-item">
        <strong>Estudiantes Elegibles:</strong> {{ estudiantesFiltrados.length }} estudiantes
      </div>
    </div>
  </div>

</app-card-container>