<app-card-container title="Visualizar Solicitudes de Cursos">
  
  <!-- Filtros -->
  <div class="filtros-container">
    <mat-form-field appearance="outline" class="filtro-field">
      <mat-label>Filtrar por estado</mat-label>
      <mat-select [(value)]="filtroEstado" (selectionChange)="cargarSolicitudes()">
        <mat-option value="todos">Todos</mat-option>
        <mat-option value="Pendiente">Pendientes</mat-option>
        <mat-option value="Aprobado">Aprobadas</mat-option>
        <mat-option value="Rechazado">Rechazadas</mat-option>
      </mat-select>
    </mat-form-field>
    
    <button mat-raised-button 
            color="primary" 
            (click)="cargarSolicitudes()"
            [disabled]="cargando">
      <mat-icon>refresh</mat-icon>
      Actualizar
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="cargando" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Cargando solicitudes...</p>
  </div>

  <!-- Tabla de solicitudes -->
  <div *ngIf="!cargando" class="solicitudes-container">
    <table mat-table [dataSource]="getSolicitudesFiltradas()" class="mat-elevation-z8">
      
      <!-- Estudiante -->
      <ng-container matColumnDef="estudiante">
        <th mat-header-cell *matHeaderCellDef>Estudiante</th>
        <td mat-cell *matCellDef="let solicitud">
          <div class="estudiante-info">
            <strong>{{ solicitud.objUsuario?.nombre }} {{ solicitud.objUsuario?.apellido }}</strong>
            <small>{{ solicitud.objUsuario?.codigo_estudiante }}</small>
          </div>
        </td>
      </ng-container>

      <!-- Curso -->
      <ng-container matColumnDef="curso">
        <th mat-header-cell *matHeaderCellDef>Curso Solicitado</th>
        <td mat-cell *matCellDef="let solicitud">
          <div class="curso-info">
            <strong>{{ solicitud.objCursoOfertadoVerano?.nombre_curso }}</strong>
            <small>{{ solicitud.objCursoOfertadoVerano?.codigo_curso }}</small>
          </div>
        </td>
      </ng-container>

      <!-- Tipo Solicitud -->
      <ng-container matColumnDef="tipo">
        <th mat-header-cell *matHeaderCellDef>Tipo</th>
        <td mat-cell *matCellDef="let solicitud">
          <span class="condicion-badge">{{ solicitud.tipoSolicitud }}</span>
        </td>
      </ng-container>

      <!-- Fecha -->
      <ng-container matColumnDef="fecha">
        <th mat-header-cell *matHeaderCellDef>Fecha</th>
        <td mat-cell *matCellDef="let solicitud">
          {{ solicitud.fecha_solicitud | date:'short' }}
        </td>
      </ng-container>

      <!-- Estado -->
      <ng-container matColumnDef="estado">
        <th mat-header-cell *matHeaderCellDef>Estado</th>
        <td mat-cell *matCellDef="let solicitud">
          <span class="estado-badge" 
                [style.background-color]="getEstadoColor(solicitud.estado)"
                [style.color]="'white'">
            {{ solicitud.estado | titlecase }}
          </span>
        </td>
      </ng-container>

      <!-- Nombre Solicitud -->
      <ng-container matColumnDef="nombre">
        <th mat-header-cell *matHeaderCellDef>Descripción</th>
        <td mat-cell *matCellDef="let solicitud">
          <span class="observaciones-text">
            {{ solicitud.nombre_solicitud || 'Sin descripción' }}
          </span>
        </td>
      </ng-container>

      <!-- Acciones -->
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef>Acciones</th>
        <td mat-cell *matCellDef="let solicitud">
          <div class="acciones-container">
            <button *ngIf="solicitud.estado === 'Pendiente'"
                    mat-raised-button 
                    color="primary" 
                    (click)="onAprobarSolicitud(solicitud)"
                    class="btn-aprobar">
              <mat-icon>check</mat-icon>
              Aprobar
            </button>
            
            <button *ngIf="solicitud.estado === 'Pendiente'"
                    mat-raised-button 
                    color="warn" 
                    (click)="onRechazarSolicitud(solicitud)"
                    class="btn-rechazar">
              <mat-icon>close</mat-icon>
              Rechazar
            </button>
            
            <span *ngIf="solicitud.estado !== 'Pendiente'" class="estado-final">
              {{ solicitud.estado === 'Aprobado' ? 'Aprobada' : 'Rechazada' }}
            </span>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['estudiante','curso','tipo','fecha','estado','nombre','acciones']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['estudiante','curso','tipo','fecha','estado','nombre','acciones'];"></tr>
    </table>

    <!-- Mensaje cuando no hay solicitudes -->
    <div *ngIf="getSolicitudesFiltradas().length === 0" class="sin-datos">
      <mat-icon>info</mat-icon>
      <p>No hay solicitudes para mostrar</p>
      <p *ngIf="filtroEstado !== 'todos'">Intenta cambiar el filtro de estado</p>
    </div>
  </div>

</app-card-container>
