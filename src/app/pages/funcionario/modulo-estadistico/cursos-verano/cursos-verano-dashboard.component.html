<!-- ===== HEADER DEL DASHBOARD ===== -->
<div class="dashboard-header">
  <div class="header-content">
    <div class="header-text">
      <div class="dashboard-title">
        <mat-icon>beach_access</mat-icon>
        Dashboard de Cursos de Verano
      </div>
      <p class="dashboard-subtitle">An√°lisis y Predicciones de Demanda</p>
      <div class="last-update" *ngIf="!loading">
        <mat-icon>schedule</mat-icon>
        √öltima actualizaci√≥n: {{ ultimaActualizacion | date:'short' }}
      </div>
    </div>
    <div class="header-actions">
      <button mat-raised-button color="primary" (click)="refrescarDatos()" [disabled]="loading">
        <mat-icon [class.fa-spin]="loading">refresh</mat-icon>
        {{ loading ? 'Actualizando...' : 'Actualizar' }}
      </button>
      <button mat-raised-button color="accent" (click)="exportarPDF()" [disabled]="loading || !data">
        <mat-icon>description</mat-icon>
        Exportar PDF
      </button>
      <button mat-raised-button color="warn" (click)="exportarExcel()" [disabled]="loading || !data">
        <mat-icon>table_chart</mat-icon>
        Exportar Excel
      </button>
    </div>
  </div>
</div>

<!-- ===== LOADING SPINNER ===== -->
<div *ngIf="loading" class="loading-indicator">
  <mat-spinner diameter="40"></mat-spinner>
  <span>Actualizando datos...</span>
</div>

<!-- ===== ERROR MESSAGE ===== -->
<div *ngIf="error && !loading" class="error-container">
  <mat-icon class="error-icon">error</mat-icon>
  <h3>Error al cargar los datos</h3>
  <p>{{ error }}</p>
  <button mat-raised-button color="primary" (click)="cargarDatos()">
    <mat-icon>refresh</mat-icon>
    Reintentar
  </button>
</div>

<!-- ===== CONTENIDO PRINCIPAL ===== -->
<div *ngIf="data && !loading" class="dashboard-container">
  <div class="dashboard-content">
  
  <!-- ===== KPIs PRINCIPALES ===== -->
  <div class="kpis-section">
    <h2 class="section-title">
      <mat-icon>dashboard</mat-icon>
      Indicadores Principales
    </h2>
    <div class="kpis-grid">
      <mat-card class="kpi-card total-solicitudes">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>description</mat-icon>
            Total Solicitudes
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="kpi-value">{{ data.resumen.totalSolicitudes }}</div>
          <div class="kpi-description">Solicitudes de cursos de verano</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="kpi-card materias-unicas">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>school</mat-icon>
            Materias √önicas
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="kpi-value">{{ data.resumen.materiasUnicas }}</div>
          <div class="kpi-description">Materias ofertadas</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="kpi-card programas-participantes">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>people</mat-icon>
            Programas Participantes
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="kpi-value">{{ data.resumen.programasParticipantes }}</div>
          <div class="kpi-description">Programas con solicitudes</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="kpi-card tasa-aprobacion">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>check_circle</mat-icon>
            Tasa de Aprobaci√≥n
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="kpi-value">{{ data.resumen.tasaAprobacion }}%</div>
          <div class="kpi-description">Porcentaje de aprobaci√≥n</div>
        </mat-card-content>
      </mat-card>
    </div>
  
  <!-- ===== TABS PRINCIPALES ===== -->
  <div class="dashboard-tabs">
    <button 
      (click)="cambiarTab('analisis-actual')" 
      [class.active]="activeTab === 'analisis-actual'"
      class="tab-button">
      An√°lisis Actual
    </button>
    <button 
      (click)="cambiarTab('predicciones')" 
      [class.active]="activeTab === 'predicciones'"
      class="tab-button">
      Predicciones
    </button>
        <button 
          (click)="cambiarTab('recomendaciones')" 
          [class.active]="activeTab === 'recomendaciones'"
          class="tab-button">
          Recomendaciones
        </button>
  </div>

  <!-- ===== CONTENIDO DE AN√ÅLISIS ACTUAL ===== -->
  <div *ngIf="activeTab === 'analisis-actual'" class="tab-content">
        
        <!-- ===== GR√ÅFICOS DE AN√ÅLISIS ===== -->
        <div class="charts-section">
          <div class="chart-row">
            <mat-card class="chart-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>pie_chart</mat-icon>
                  Top Materias por Demanda
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div class="chart-content">
                  <!-- Mostrar loading mientras se carga la gr√°fica -->
                  <div *ngIf="loading" class="chart-loading">
                    <i class="fas fa-spinner fa-spin"></i> Cargando gr√°fica...
                  </div>
                  
                  <!-- Canvas para la gr√°fica -->
                  <canvas 
                    id="materiasChart" 
                    *ngIf="!loading && topMateriasData && topMateriasData.length > 0"
                    width="400" 
                    height="200">
                  </canvas>
                </div>
                <!-- CONECTAR A LOS DATOS DEL BACKEND -->
                <div class="chart-data" *ngIf="data && data.topMaterias && data.topMaterias.length > 0; else noDataMaterias">
                  <div *ngFor="let materia of data.topMaterias" class="materia-item">
                    <div class="materia-nombre">{{ materia.nombre }}</div>
                    <div class="materia-solicitudes">{{ materia.solicitudes }} solicitudes</div>
                    <div class="materia-porcentaje">{{ materia.porcentaje }}%</div>
                  </div>
                </div>
                <ng-template #noDataMaterias>
                  <div class="no-data">No hay datos disponibles</div>
                </ng-template>
              </mat-card-content>
            </mat-card>

            <mat-card class="chart-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>bar_chart</mat-icon>
                  An√°lisis por Programa
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div class="chart-content">
                  <!-- Mostrar loading mientras se carga la gr√°fica -->
                  <div *ngIf="loading" class="chart-loading">
                    <i class="fas fa-spinner fa-spin"></i> Cargando gr√°fica...
                  </div>
                  
                  <!-- Canvas para la gr√°fica -->
                  <canvas 
                    id="programasChart" 
                    *ngIf="!loading && analisisProgramaData && analisisProgramaData.length > 0"
                    width="400" 
                    height="200">
                  </canvas>
                </div>
                <!-- CONECTAR A LOS DATOS DEL BACKEND -->
                <div class="chart-data" *ngIf="data && data.analisisPorPrograma && data.analisisPorPrograma.length > 0; else noDataProgramas">
                  <div *ngFor="let programa of data.analisisPorPrograma" class="programa-item">
                    <div class="programa-nombre">{{ programa.nombre }}</div>
                    <div class="programa-solicitudes">{{ programa.solicitudes }} solicitudes</div>
                    <div class="programa-porcentaje">{{ programa.porcentaje }}%</div>
                  </div>
                </div>
                <ng-template #noDataProgramas>
                  <div class="no-data">No hay datos disponibles</div>
                </ng-template>
              </mat-card-content>
            </mat-card>
          </div>

          <div class="chart-row">
            <mat-card class="chart-card full-width">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>show_chart</mat-icon>
                  Tendencias Temporales
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div class="chart-content">
                  <!-- Mostrar loading mientras se carga la gr√°fica -->
                  <div *ngIf="loading" class="chart-loading">
                    <i class="fas fa-spinner fa-spin"></i> Cargando gr√°fica...
                  </div>
                  
                  <!-- Canvas para la gr√°fica -->
                  <canvas 
                    id="tendenciasChart" 
                    *ngIf="!loading && tendenciasTemporalesData && tendenciasTemporalesData.length > 0"
                    width="400" 
                    height="200">
                  </canvas>
                  
                  <!-- Mostrar datos si no hay gr√°fica -->
                  <div *ngIf="!loading && data && data.tendenciasTemporales && data.tendenciasTemporales.length > 0 && !tendenciasTemporalesData?.length" class="tendencias-data">
                    <div *ngFor="let tendencia of data.tendenciasTemporales" class="tendencia-card">
                      <div class="tendencia-mes">{{ tendencia.mes }}</div>
                      <div class="tendencia-solicitudes">{{ tendencia.solicitudes }} solicitudes</div>
                      <div class="tendencia-porcentaje">{{ tendencia.porcentaje }}%</div>
                    </div>
                  </div>
                  
                  <!-- Mensaje si no hay datos -->
                  <div *ngIf="!loading && (!data || !data.tendenciasTemporales || data.tendenciasTemporales.length === 0)" class="no-data">
                    No hay datos de tendencias temporales disponibles
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </div>

        <!-- ===== ESTADOS DE SOLICITUDES ===== -->
        <div class="estados-section">
          <h3 class="section-title">
            <mat-icon>assignment</mat-icon>
            Estados de Solicitudes
          </h3>
          <div class="estados-grid">
            <mat-card class="estado-card aprobada">
              <mat-card-content>
                <div class="estado-header">
                  <mat-icon>check_circle</mat-icon>
                  <span class="estado-nombre">Aprobada</span>
                </div>
                <div class="estado-valor">{{ data.estadosSolicitudes.APROBADA || 0 }}</div>
              </mat-card-content>
            </mat-card>

            <mat-card class="estado-card enviada">
              <mat-card-content>
                <div class="estado-header">
                  <mat-icon>send</mat-icon>
                  <span class="estado-nombre">Enviada</span>
                </div>
                <div class="estado-valor">{{ data.estadosSolicitudes.ENVIADA || 0 }}</div>
              </mat-card-content>
            </mat-card>

            <mat-card class="estado-card en-proceso">
              <mat-card-content>
                <div class="estado-header">
                  <mat-icon>hourglass_empty</mat-icon>
                  <span class="estado-nombre">En Proceso</span>
                </div>
                <div class="estado-valor">{{ (data.estadosSolicitudes.APROBADA_FUNCIONARIO || 0) + (data.estadosSolicitudes.APROBADA_COORDINADOR || 0) }}</div>
              </mat-card-content>
            </mat-card>

            <mat-card class="estado-card rechazada">
              <mat-card-content>
                <div class="estado-header">
                  <mat-icon>cancel</mat-icon>
                  <span class="estado-nombre">Rechazada</span>
                </div>
                <div class="estado-valor">{{ data.estadosSolicitudes.RECHAZADA || 0 }}</div>
              </mat-card-content>
            </mat-card>
          </div>
        </div>

      </div>
  </div>

  <!-- ===== CONTENIDO DE PREDICCIONES ===== -->
  <div *ngIf="activeTab === 'predicciones'" class="tab-content predicciones-content">
        
        <!-- ===== RESUMEN DE PREDICCIONES ===== -->
        <div class="predicciones-resumen">
          <mat-card class="resumen-card">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>psychology</mat-icon>
                Resumen de Predicciones
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="resumen-grid">
                <div class="resumen-item">
                  <div class="resumen-label">Demanda Estimada Pr√≥ximo Per√≠odo</div>
                  <div class="resumen-valor">{{ data.predicciones.demandaEstimadaProximoPeriodo }}</div>
                </div>
                <div class="resumen-item">
                  <div class="resumen-label">Confiabilidad</div>
                  <div class="resumen-valor confiabilidad" 
                       [class]="'confiabilidad-' + data.predicciones.confiabilidad.toLowerCase()">
                    {{ data.predicciones.confiabilidad }}
                  </div>
                </div>
                <div class="resumen-item">
                  <div class="resumen-label">Fecha de Predicci√≥n</div>
                  <div class="resumen-valor">{{ data.predicciones.fechaPrediccion | date:'short' }}</div>
                </div>
                <!-- ‚ùå ELIMINADO: Metodolog√≠a (campo t√©cnico innecesario) -->
              </div>
            </mat-card-content>
          </mat-card>
        </div>

        <!-- ===== GR√ÅFICOS DE PREDICCIONES ===== -->
        <div class="predicciones-charts">
          <div class="chart-row">
            <mat-card class="chart-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>trending_up</mat-icon>
                  Predicciones por Materia
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <!-- ELIMINAR el √°rea blanca vac√≠a y mostrar directamente las tarjetas -->
                <div *ngIf="data && data.predicciones && data.predicciones.materiasConTendenciaCreciente && data.predicciones.materiasConTendenciaCreciente.length > 0" class="predicciones-materias">
                  <div *ngFor="let materia of data.predicciones.materiasConTendenciaCreciente" class="prediccion-materia-card">
                    <div class="materia-nombre">{{ materia.nombre }}</div>
                    <div class="demanda-actual">Actual: {{ materia.demandaActual }}</div>
                    <div class="demanda-estimada">Estimada: {{ materia.demandaEstimada }}</div>
                    <div class="variacion">Variaci√≥n: {{ materia.variacion }}</div>
                    <div class="tendencia creciente">CRECIENTE</div>
                  </div>
                </div>
                <div *ngIf="!data || !data.predicciones || !data.predicciones.materiasConTendenciaCreciente || data.predicciones.materiasConTendenciaCreciente.length === 0" class="no-data">
                  No hay datos de predicciones disponibles
                </div>
              </mat-card-content>
            </mat-card>

            <mat-card class="chart-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>school</mat-icon>
                  Predicciones por Programa
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <!-- ELIMINAR el √°rea blanca vac√≠a y mostrar directamente las tarjetas -->
                <div *ngIf="data && data.predicciones && data.predicciones.todasLasPrediccionesPorPrograma && data.predicciones.todasLasPrediccionesPorPrograma.length > 0" class="predicciones-programas">
                  <div *ngFor="let programa of data.predicciones.todasLasPrediccionesPorPrograma" class="prediccion-programa-card">
                    <div class="programa-nombre">{{ programa.nombre }}</div>
                    <div class="demanda-actual">Actual: {{ programa.demandaActual }}</div>
                    <div class="demanda-estimada">Estimada: {{ programa.demandaEstimada }}</div>
                    <div class="variacion">Variaci√≥n: {{ programa.variacion }}</div>
                    <div class="tendencia" [ngClass]="'tendencia-' + programa.tendencia?.toLowerCase()">{{ programa.tendencia }}</div>
                  </div>
                </div>
                <div *ngIf="!data || !data.predicciones || !data.predicciones.todasLasPrediccionesPorPrograma || data.predicciones.todasLasPrediccionesPorPrograma.length === 0" class="no-data">
                  No hay datos de predicciones disponibles
                </div>
              </mat-card-content>
            </mat-card>
          </div>

          <div class="chart-row">
            <mat-card class="chart-card full-width">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>schedule</mat-icon>
                  Predicciones Temporales
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <!-- REEMPLAZAR la secci√≥n de "Predicciones Temporales" -->
                <div *ngIf="data && data.predicciones && data.predicciones.prediccionesTemporales" class="predicciones-temporales">
                  <div class="prediccion-temporal-card">
                    <div class="mes-pico">Mes Pico: {{ data.predicciones.prediccionesTemporales.mesPico }}</div>
                    <div class="demanda-actual">Demanda Actual: {{ data.predicciones.prediccionesTemporales.demandaActualMesPico }}</div>
                    <div class="demanda-estimada">Demanda Estimada: {{ data.predicciones.demandaEstimadaProximoPeriodo }}</div>
                    <div class="meses-recomendados">
                      <span>Meses Recomendados: </span>
                      <span *ngFor="let mes of data.predicciones.prediccionesTemporales.mesesRecomendados; let last = last">
                        {{ mes }}<span *ngIf="!last">, </span>
                      </span>
                    </div>
                  </div>
                </div>
                <div *ngIf="!data || !data.predicciones || !data.predicciones.prediccionesTemporales" class="no-data">
                  No hay datos de predicciones temporales disponibles
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </div>

        <!-- ===== AN√ÅLISIS DE TENDENCIAS ===== -->
        <div class="tendencias-section">
          <h3 class="section-title">
            <mat-icon>analytics</mat-icon>
            An√°lisis de Tendencias
          </h3>
          
          <mat-accordion>
            <!-- ===== MATERIAS CON TENDENCIA CRECIENTE ===== -->
            <mat-expansion-panel *ngIf="data.predicciones.materiasConTendenciaCreciente.length > 0">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <mat-icon class="tendencia-creciente">trending_up</mat-icon>
                  Materias con Tendencia Creciente
                </mat-panel-title>
                <mat-panel-description>
                  {{ data.predicciones.materiasConTendenciaCreciente.length }} materias
                </mat-panel-description>
              </mat-expansion-panel-header>
              <div class="tendencias-content">
                <mat-card *ngFor="let materia of data.predicciones.materiasConTendenciaCreciente" 
                          class="tendencia-card creciente">
                  <mat-card-content>
                    <div class="tendencia-header">
                      <h4>{{ materia.nombre }}</h4>
                      <mat-chip [color]="'primary'" selected>
                        <mat-icon>{{ getTendenciaIcon(materia.tendencia) }}</mat-icon>
                        {{ materia.porcentajeVariacion }}%
                      </mat-chip>
                    </div>
                    <div class="tendencia-datos">
                      <div class="dato-item">
                        <span class="dato-label">Demanda Actual:</span>
                        <span class="dato-valor">{{ materia.demandaActual }}</span>
                      </div>
                      <div class="dato-item">
                        <span class="dato-label">Demanda Estimada:</span>
                        <span class="dato-valor">{{ materia.demandaEstimada }}</span>
                      </div>
                      <div class="dato-item">
                        <span class="dato-label">Variaci√≥n:</span>
                        <span class="dato-valor" [style.color]="getTendenciaColor(materia.tendencia)">
                          {{ materia.variacion > 0 ? '+' : '' }}{{ materia.variacion }}
                        </span>
                      </div>
                    </div>
                  </mat-card-content>
                </mat-card>
              </div>
            </mat-expansion-panel>

            <!-- ===== MATERIAS CON TENDENCIA DECRECIENTE ===== -->
            <mat-expansion-panel *ngIf="data.predicciones.materiasConTendenciaDecreciente.length > 0">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <mat-icon class="tendencia-decreciente">trending_down</mat-icon>
                  Materias con Tendencia Decreciente
                </mat-panel-title>
                <mat-panel-description>
                  {{ data.predicciones.materiasConTendenciaDecreciente.length }} materias
                </mat-panel-description>
              </mat-expansion-panel-header>
              <div class="tendencias-content">
                <mat-card *ngFor="let materia of data.predicciones.materiasConTendenciaDecreciente" 
                          class="tendencia-card decreciente">
                  <mat-card-content>
                    <div class="tendencia-header">
                      <h4>{{ materia.nombre }}</h4>
                      <mat-chip [color]="'warn'" selected>
                        <mat-icon>{{ getTendenciaIcon(materia.tendencia) }}</mat-icon>
                        {{ materia.porcentajeVariacion }}%
                      </mat-chip>
                    </div>
                    <div class="tendencia-datos">
                      <div class="dato-item">
                        <span class="dato-label">Demanda Actual:</span>
                        <span class="dato-valor">{{ materia.demandaActual }}</span>
                      </div>
                      <div class="dato-item">
                        <span class="dato-label">Demanda Estimada:</span>
                        <span class="dato-valor">{{ materia.demandaEstimada }}</span>
                      </div>
                      <div class="dato-item">
                        <span class="dato-label">Variaci√≥n:</span>
                        <span class="dato-valor" [style.color]="getTendenciaColor(materia.tendencia)">
                          {{ materia.variacion > 0 ? '+' : '' }}{{ materia.variacion }}
                        </span>
                      </div>
                    </div>
                  </mat-card-content>
                </mat-card>
              </div>
            </mat-expansion-panel>

            <!-- ===== MATERIAS ESTABLES ===== -->
            <mat-expansion-panel *ngIf="data.predicciones.materiasEstables.length > 0">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <mat-icon class="tendencia-estable">trending_flat</mat-icon>
                  Materias Estables
                </mat-panel-title>
                <mat-panel-description>
                  {{ data.predicciones.materiasEstables.length }} materias
                </mat-panel-description>
              </mat-expansion-panel-header>
              <div class="tendencias-content">
                <mat-card *ngFor="let materia of data.predicciones.materiasEstables" 
                          class="tendencia-card estable">
                  <mat-card-content>
                    <div class="tendencia-header">
                      <h4>{{ materia.nombre }}</h4>
                      <mat-chip [color]="'accent'" selected>
                        <mat-icon>{{ getTendenciaIcon(materia.tendencia) }}</mat-icon>
                        {{ materia.porcentajeVariacion }}%
                      </mat-chip>
                    </div>
                    <div class="tendencia-datos">
                      <div class="dato-item">
                        <span class="dato-label">Demanda Actual:</span>
                        <span class="dato-valor">{{ materia.demandaActual }}</span>
                      </div>
                      <div class="dato-item">
                        <span class="dato-label">Demanda Estimada:</span>
                        <span class="dato-valor">{{ materia.demandaEstimada }}</span>
                      </div>
                      <div class="dato-item">
                        <span class="dato-label">Variaci√≥n:</span>
                        <span class="dato-valor" [style.color]="getTendenciaColor(materia.tendencia)">
                          {{ materia.variacion > 0 ? '+' : '' }}{{ materia.variacion }}
                        </span>
                      </div>
                    </div>
                  </mat-card-content>
                </mat-card>
              </div>
            </mat-expansion-panel>
          </mat-accordion>
        </div>

      </div>
  </div>

  <!-- ===== CONTENIDO DE RECOMENDACIONES ===== -->
  <div *ngIf="activeTab === 'recomendaciones'" class="tab-content">
    <div class="recomendaciones-section">
      <!-- RESUMEN DE RECOMENDACIONES -->
      <mat-card class="resumen-recomendaciones-card">
      <mat-card-header>
        <mat-card-title>Resumen de Recomendaciones</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="stats-grid">
          <div class="stat alta">
            <div class="numero">{{ estadisticasRecomendaciones.prioridadAlta || 0 }}</div>
            <div class="label">üî¥ ALTAS</div>
          </div>
          <div class="stat media">
            <div class="numero">{{ estadisticasRecomendaciones.prioridadMedia || 0 }}</div>
            <div class="label">üü° MEDIAS</div>
          </div>
          <div class="stat baja">
            <div class="numero">{{ estadisticasRecomendaciones.prioridadBaja || 0 }}</div>
            <div class="label">üü¢ BAJAS</div>
          </div>
          <div class="stat critica" *ngIf="estadisticasRecomendaciones.alertasCriticas > 0">
            <div class="numero">{{ estadisticasRecomendaciones.alertasCriticas }}</div>
            <div class="label">‚ö†Ô∏è CR√çTICAS</div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- ALERTAS CR√çTICAS -->
    <mat-card class="alerta-critica-card" *ngFor="let alerta of alertasCriticas">
      <mat-card-content>
        <h3>{{ alerta.titulo }}</h3>
        <p>{{ alerta.descripcion }}</p>
        <div class="acciones-urgentes">
          <strong>üö® ACCIONES URGENTES:</strong>
          <ul>
            <li *ngFor="let accion of alerta.acciones">{{ accion }}</li>
          </ul>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- RECOMENDACIONES -->
    <div class="recomendaciones-list">
      <mat-card class="rec-card" 
           *ngFor="let rec of recomendaciones"
           [style.border-left-color]="getColorPrioridad(rec.prioridad)">
        
        <mat-card-content>
          <div class="header">
            <span class="badge" [style.background]="getColorPrioridad(rec.prioridad)">
              {{ getIconoPrioridad(rec.prioridad) }} {{ rec.prioridad }}
            </span>
            <h3>{{ rec.titulo }}</h3>
            <button mat-icon-button class="btn-expandir" (click)="toggleExpandir(rec.id)">
              <mat-icon>{{ estaExpandida(rec.id) ? 'expand_less' : 'expand_more' }}</mat-icon>
            </button>
          </div>
          
          <p class="descripcion">{{ rec.descripcion }}</p>
          
          <!-- PROYECCI√ìN -->
          <div class="seccion" *ngIf="rec.demandaActual">
            <strong>PROYECCI√ìN:</strong>
            <p>{{ rec.demandaActual }} ‚Üí {{ rec.demandaProyectada }} estudiantes 
               ({{ rec.porcentajeCrecimiento > 0 ? '+' : '' }}{{ rec.porcentajeCrecimiento }}%)</p>
          </div>
          
          <!-- RECURSOS -->
          <div class="seccion" *ngIf="rec.recursos">
            <strong>üë• RECURSOS NECESARIOS:</strong>
            <ul>
              <li>{{ rec.recursos.docentes }} docente(s) especializado(s)</li>
              <li>{{ rec.recursos.aulas }} aula(s) o laboratorio(s)</li>
              <li *ngIf="rec.recursos.laboratorios">{{ rec.recursos.laboratorios }} laboratorio(s)</li>
              <li>{{ rec.recursos.gruposRecomendados }} grupo(s) de {{ rec.recursos.capacidadPorGrupo }} estudiantes</li>
            </ul>
          </div>
          
          <!-- ACCIONES -->
          <div class="seccion">
            <strong>‚úÖ ACCIONES RECOMENDADAS:</strong>
            <div class="checklist">
              <div class="checklist-item" *ngFor="let accion of rec.acciones; let i = index">
                <mat-checkbox [id]="rec.id + '_' + i">{{ accion }}</mat-checkbox>
              </div>
            </div>
          </div>
          
          <!-- DETALLES EXPANDIDOS -->
          <div *ngIf="estaExpandida(rec.id)" class="detalles-expandidos">
            
            <div class="seccion" *ngIf="rec.cronograma">
              <strong>üìÖ CRONOGRAMA:</strong>
              <ul>
                <li>‚è∞ Inicio gesti√≥n: {{ rec.cronograma.inicioGestion }}</li>
                <li>üì¢ Publicaci√≥n oferta: {{ rec.cronograma.publicacionOferta }}</li>
                <li>üë®‚Äçüè´ Contrataci√≥n docentes: {{ rec.cronograma.contratacionDocentes }}</li>
                <li>üìù Inicio inscripciones: {{ rec.cronograma.inicioInscripciones }}</li>
              </ul>
            </div>
            
            <div class="seccion" *ngIf="rec.impacto">
              <strong>üí∞ IMPACTO ESPERADO:</strong>
              <ul>
                <li>Estudiantes atendidos: {{ rec.impacto.estudiantesAtendidos }}</li>
                <li>Estudiantes beneficiados: {{ rec.impacto.estudiantesBeneficiados }}</li>
                <li>Cobertura objetivo: {{ rec.impacto.tasaCoberturaObjetivo }}</li>
                <li>Inversi√≥n estimada: {{ rec.impacto.inversionEstimada }}</li>
              </ul>
            </div>
            
            <div class="seccion justificacion">
              <strong>üí° JUSTIFICACI√ìN:</strong>
              <p>{{ rec.justificacion }}</p>
            </div>
            
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Mensaje si no hay recomendaciones -->
    <mat-card *ngIf="!recomendaciones || recomendaciones.length === 0" class="no-data-card">
      <mat-card-content>
        <div class="no-data">
          <mat-icon>info</mat-icon>
          <p>No hay recomendaciones disponibles en este momento.</p>
          <p>Las recomendaciones se generan autom√°ticamente bas√°ndose en el an√°lisis de tendencias y predicciones.</p>
        </div>
      </mat-card-content>
    </mat-card>
    </div>
  </div>
  
  </div> <!-- Cierre dashboard-content -->
